import{d as t,ar as z,o as l,c as m,u as o,H as y,w as d,f as n,I as w,J as h,_ as x,e as u,U as S,a as j,B as f,C as v}from"./app.e0b64a2d.js";import D from"./ModalSocietaSportiva.9f9aa77d.js";import{g as M,b4 as k,b5 as c}from"./check_box.9d1619d3.js";import{D as p}from"./select-box.44b95513.js";import{_ as E}from"./date-box.58c5ef6e.js";import{_ as b}from"./number-box.60e27d35.js";import"./radio-group.dae3669f.js";import{D as N}from"./text-area.2fa8fbc0.js";import"./data_source.7e477e74.js";import{a as g}from"./response.70bff4ea.js";import"./check-box.76fadd22.js";import"./select_box.f7ade88d.js";import"./date_box.af268e83.js";import"./number_box.9ca8c8f2.js";const $=t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),C={class:"fixed inset-0 z-50 overflow-y-auto"},A={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},I={key:0,class:"flex justify-center items-center"},U=t("svg",{class:"animate-spin h-5 w-5 text-gray-900",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),P=[U],T={key:1},F={class:"flex flex-col gap-3"},Y={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},B={class:"flex flex-col gap-1"},H=t("div",{class:"relative"},[t("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[t("div",{class:"w-full border-t border-gray-300"})]),t("div",{class:"relative flex justify-center"},[t("span",{class:"bg-white px-2 text-sm text-gray-500"},"Data e ora prenotazione")])],-1),V={key:0,class:"text-red-500 text-sm"},L=t("div",{class:"relative"},[t("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[t("div",{class:"w-full border-t border-gray-300"})]),t("div",{class:"relative flex justify-center"},[t("span",{class:"bg-white px-2 text-sm text-gray-500"},"Paziente / Atleta")])],-1),q={class:"flex items-center gap-3"},O=t("div",{class:"relative"},[t("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[t("div",{class:"w-full border-t border-gray-300"})]),t("div",{class:"relative flex justify-center"},[t("span",{class:"bg-white px-2 text-sm text-gray-500"},"Listino e sport")])],-1),J={class:"flex flex-col gap-1"},K=t("div",{class:"relative"},[t("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[t("div",{class:"w-full border-t border-gray-300"})]),t("div",{class:"relative flex justify-center"},[t("span",{class:"bg-white px-2 text-sm text-gray-500"},"Qualcosa")])],-1),Q=t("div",{class:"relative"},[t("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[t("div",{class:"w-full border-t border-gray-300"})]),t("div",{class:"relative flex justify-center"},[t("span",{class:"bg-white px-2 text-sm text-gray-500"},"Dettagli Societ\xE0 sportiva")])],-1),R={key:0,class:"flex justify-center items-center h-full"},G={key:1},W={class:"flex justify-between pt-1"},X=t("span",{class:"text-sm text-gray-500"},"Ragione sociale: ",-1),Z={class:"text-sm font-medium text-gray-900 capitalize"},ee=t("div",{class:"relative"},[t("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[t("div",{class:"w-full border-t border-gray-300"})]),t("div",{class:"relative flex justify-center"},[t("span",{class:"bg-white px-2 text-sm text-gray-500"},"Altro")])],-1),ie={class:"grid grid-cols-1 pt-4"},te={class:"mt-5 sm:mt-6 flex flex-col sm:flex-row sm:justify-around gap-4"},ae=t("button",{class:"opacity-0 absolute bottom-0"},null,-1),se={props:["appointmentData"],emits:["update","store","close"],data(){return{fetching:!1,saving:!1,errors:null,now:dayjs().format("YYYY-MM-DD HH:mm"),struttura:[],prenotazione:[],societa:null,listini_agonistici:[],listini_non_agonistici:[],colori:[],elenco_sport:[],modal_societa_id:null}},computed:{disabledElement(){return this.prenotazione.accettata||this.saving},open(){return this.appointmentData!==null},sezioneVisita(){return this.prenotazione.sezione_visita},ambulatoriPrenotabili(){return this.struttura.ambulatori},mediciPrenotabili(){let i=[];return this.$page.props.settings.limita_medici_con_orario_medico.value?this.struttura.orari_medici.forEach(e=>{dayjs(this.prenotazione.data_inizio,"YYYY-MM-DD").isSame(e.data_inizio,"day")&&e.ambulatorio_id==this.prenotazione.ambulatorio_id&&i.push(this.medici.find(a=>a.id==e.medico_id))}):i=this.medici,[...new Set(i.map(e=>e))]},listiniAgonisticiFiltratiPerSport(){var r;let i=this.prenotazione.visita.sport_id&&this.prenotazione.visita.sport_id!=0?this.listini_agonistici.filter(e=>e.tipo_visita==this.elenco_sport.find(a=>a.id===this.prenotazione.visita.sport_id).tipo_visita):this.listini_agonistici.filter(e=>e.agonistico);return this.listini_agonistici.find(e=>e.id===this.prenotazione.visita.listino_id)&&(this.prenotazione.visita.listino_id=(r=i[0])==null?void 0:r.id),i},listiniNonAgonistici(){return this.listini_non_agonistici},orarioInOrarioMedico(){return this.struttura.orari_medici.find(i=>dayjs(this.prenotazione.data_inizio).isBetween(i.data_inizio,i.data_fine,null,"[]")&&i.ambulatorio_id==this.prenotazione.ambulatorio_id&&i.medico_id==this.prenotazione.medico_id)}},watch:{"prenotazione.ambulatorio_id":{handler(i,r){r&&r!==i&&(this.prenotazione.medico_id=null)}}},async created(){this.appointmentData.id?(this.fetching=!0,await axios.get(`api/sphere/medsport/prenotazione/edit/${this.appointmentData.id}`).then(i=>{this.prenotazione=i.data.prenotazione,this.prenotazione.durata=dayjs(i.data.prenotazione.data_fine).diff(i.data.prenotazione.data_inizio,"minute"),this.colori=i.data.colori,this.elenco_sport=i.data.elenco_sport,this.struttura=i.data.struttura,this.listini_agonistici=i.data.listini_agonistici,this.listini_non_agonistici=i.data.listini_non_agonistici,this.medici=i.data.medici}).catch(i=>{this.fetching=!1,this.$emit("close")}),this.fetching=!1):(this.fetching=!0,await axios.post("api/sphere/medsport/prenotazione/create",this.appointmentData).then(i=>{this.prenotazione=i.data.prenotazione,this.prenotazione.durata=dayjs(i.data.prenotazione.data_fine).diff(i.data.prenotazione.data_inizio,"minute"),this.prenotazione.numero_paz=1,this.struttura=i.data.struttura,this.listini_agonistici=i.data.listini_agonistici,this.listini_non_agonistici=i.data.listini_non_agonistici,this.colori=i.data.colori,this.elenco_sport=i.data.elenco_sport,this.medici=i.data.medici}).catch(i=>{this.fetching=!1,this.$emit("close")}),this.fetching=!1)},methods:{apriModalModificaSocieta(){this.modal_societa_id=this.prenotazione.societa_id},apriModalNuovaSocieta(){this.modal_societa_id="new"},societaSalvata(i){this.prenotazione.societa_id=i.id,this.prenotazione.societa_sportiva=i,this.modal_societa_id=null},societaModificata(i){this.prenotazione.societa_id=i.id,this.prenotazione.societa_sportiva=i,this.modal_societa_id=null},selezionaSocieta(i){this.prenotazione.societa_sportiva=i.selectedItem},formatDataNascita(i){return dayjs(i).format("DD/MM/YYYY")},errorFor(i){return!!(this.errors!==null&&this.errors[i])},societaItemTemplate(i){return'<div class="flex justify-between"><span class="truncate">'+i.ragione_sociale+"</span></div>"},ambulatorioItemTemplate(i){return'<div class="flex justify-between"><span class="truncate">'+i.nome+"</span></div>"},medicoItemTemplate(i){return'<div class="flex justify-between"><span class="truncate">'+i.ragione_sociale+"</span></div>"},sportItemTemplate(i){return'<div class="flex justify-between"><span class="uppercase truncate">'+i.nome+"</span><span>"+i.tipo_visita+"</span></div>"},listinoItemTemplate(i){return'<div class="flex justify-between"><span class="truncate">'+i.nome+"</span><span>"+i.codice+"</span></div>"},coloriTemplate(i){return'<div class="flex capitalize font-bold text-['+i.codice+']">'+i.nome+"</div>"},salvaPrenotazione(){this.prenotazione.id?this.update():this.store()},async update(){this.saving=!0,this.errors=null,await axios.put(`api/sphere/prenotazione/${this.prenotazione.id}`,this.prenotazione).then(i=>{this.$emit("update",i.data)}).catch(i=>{g(i)&&(this.errors=i.response.data.errors),this.saving=!1}),this.saving=!1},async store(){this.errors=null,this.saving=!0,await axios.post("api/sphere/medsport/prenotazione/store",this.prenotazione).then(i=>{this.$emit("store",i.data)}).catch(i=>{g(i)&&(this.errors=i.response.data.errors),this.saving=!1}),this.saving=!1},calcolaAnni(i){const r=dayjs(i);return dayjs().diff(r,"year")}}},_e=Object.assign(se,{__name:"ModalPrenotazioneMedsportSocieta",setup(i){const r=new M({store:new k({key:"id",useDefaultSearch:!1,load(e){if(e.searchValue)return axios.get(`api/sphere/ricerca-societa/${e.searchValue}`).then(a=>a.data).catch(a=>{throw new Error("Errore caricamento")})},byKey:e=>axios.get(`api/sphere/societa-sportiva/${e}`).then(a=>a.data).catch(a=>{throw new Error("Errore caricamento localit\xE0")}),errorHandler:e=>{console.log(e.message)}})});return(e,a)=>{const _=z("AlertErrors");return l(),m(o(y),{as:"template",show:e.open},{default:d(()=>[n(o(w),{as:"div",class:"relative z-50"},{default:d(()=>[n(o(h),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:d(()=>[$]),_:1}),t("div",C,[t("div",A,[n(o(h),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:d(()=>[n(o(x),{class:"relative transform rounded-lg bg-white px-4 pt-5 pb-4 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl sm:p-6"},{default:d(()=>[e.fetching?(l(),u("div",I,P)):(l(),u("div",T,[n(o(S),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900 text-center"},{default:d(()=>[j(f(e.prenotazione.id?"Modifica prenotazione medsport (Societ\xE0 sportiva)":"Nuova prenotazione medsport (Societ\xE0 sportiva)"),1)]),_:1}),t("div",F,[t("div",Y,[t("div",B,[H,n(o(E),{value:e.prenotazione.data_inizio,"onUpdate:value":a[0]||(a[0]=s=>e.prenotazione.data_inizio=s),min:e.now,type:"datetime","is-valid":!e.errorFor("data_inizio"),label:"Data e ora della visita",disabled:e.disabledElement},null,8,["value","min","is-valid","disabled"]),n(o(b),{value:e.prenotazione.durata,"onUpdate:value":a[1]||(a[1]=s=>e.prenotazione.durata=s),placeholder:"Durata visita in minuti","show-spin-buttons":!0,"is-valid":!e.errorFor("durata"),label:"Durata della visita",disabled:e.disabledElement},null,8,["value","is-valid","disabled"]),n(o(p),{value:e.prenotazione.ambulatorio_id,"onUpdate:value":a[2]||(a[2]=s=>e.prenotazione.ambulatorio_id=s),"data-source":e.ambulatoriPrenotabili,"value-expr":"id","display-expr":"nome",label:"Ambulatorio","label-mode":"static",placeholder:"---","no-data-text":"Nessun ambulatorio selezionabile",disabled:e.ambulatoriPrenotabili.length===0||e.disabledElement,"drop-down-options":{maxHeight:"200px"},"item-template":e.ambulatorioItemTemplate,"is-valid":!e.errorFor("ambulatorio_id")},null,8,["value","data-source","disabled","item-template","is-valid"]),n(o(p),{value:e.prenotazione.medico_id,"onUpdate:value":a[3]||(a[3]=s=>e.prenotazione.medico_id=s),"search-enabled":!0,"data-source":e.mediciPrenotabili,"value-expr":"id","display-expr":"ragione_sociale",label:"Medico","label-mode":"static",placeholder:"---","no-data-text":"Nessun medico selezionabile",disabled:e.mediciPrenotabili.length===0||e.disabledElement,"drop-down-options":{maxHeight:"200px"},"item-template":e.medicoItemTemplate,"is-valid":!e.errorFor("medico_id")},null,8,["value","data-source","disabled","item-template","is-valid"]),!e.orarioInOrarioMedico&&e.$page.props.settings.avviso_presenza_orario_medico.value?(l(),u("p",V," Medico non disponibile nell'ambulatorio/orario selezionato ")):v("",!0),L,t("div",q,[n(o(c),{id:"saveButton",width:"100%",text:"Nuova societ\xE0",icon:"plus",type:"normal","styling-mode":"contained",disabled:!1,onClick:e.apriModalNuovaSocieta},null,8,["onClick"]),n(o(c),{id:"saveButton",width:"100%",height:"100%",text:"Apri societ\xE0",icon:"activefolder",type:"normal","styling-mode":"contained",disabled:!e.prenotazione.societa_id,onClick:e.apriModalModificaSocieta},null,8,["disabled","onClick"])]),n(o(p),{value:e.prenotazione.societa_id,"onUpdate:value":a[4]||(a[4]=s=>e.prenotazione.societa_id=s),"data-source":o(r),"value-expr":"id","display-expr":"ragione_sociale","search-enabled":!0,"search-timeout":500,label:"Societ\xE0 sportiva","label-mode":"static","no-data-text":"Nessuna societ\xE0 trovata",disabled:e.disabledElement,"drop-down-options":{maxHeight:"200px"},"on-selection-changed":e.selezionaSocieta,"is-valid":!e.errorFor("societa_id"),"open-on-field-click":!1,"min-search-length":2},null,8,["value","data-source","disabled","on-selection-changed","is-valid"]),n(o(b),{value:e.prenotazione.numero_paz,"onUpdate:value":a[5]||(a[5]=s=>e.prenotazione.numero_paz=s),placeholder:"1","show-spin-buttons":!0,"is-valid":!e.errorFor("numero_paz"),label:"Numero di atleti",disabled:e.disabledElement},null,8,["value","is-valid","disabled"]),O,n(o(p),{value:e.prenotazione.visita.sport_id,"onUpdate:value":a[6]||(a[6]=s=>e.prenotazione.visita.sport_id=s),label:"Sport praticato","data-source":e.elenco_sport,"value-expr":"id","display-expr":"nome","search-enabled":!0,"item-template":e.sportItemTemplate,"is-valid":!e.errorFor("visita.sport_id"),disabled:e.disabledElement,"no-data-text":"Nessuno sport trovato"},null,8,["value","data-source","item-template","is-valid","disabled"]),n(o(p),{value:e.prenotazione.visita.listino_id,"onUpdate:value":a[7]||(a[7]=s=>e.prenotazione.visita.listino_id=s),"search-enabled":!0,label:"Listino Agonistico","data-source":e.listiniAgonisticiFiltratiPerSport,"value-expr":"id","display-expr":"nome","item-template":e.listinoItemTemplate,"is-valid":!e.errorFor("visita.listino_id"),disabled:e.disabledElement,"no-data-text":"Nessun listino trovato"},null,8,["value","data-source","item-template","is-valid","disabled"]),n(o(p),{value:e.prenotazione.visita.listino_id,"onUpdate:value":a[8]||(a[8]=s=>e.prenotazione.visita.listino_id=s),"search-enabled":!0,label:"Listino non Agonistico","data-source":e.listini_non_agonistici,"value-expr":"id","display-expr":"nome","item-template":e.listinoItemTemplate,"is-valid":!e.errorFor("visita.listino_id"),disabled:e.disabledElement,"no-data-text":"Nessun listino trovato"},null,8,["value","data-source","item-template","is-valid","disabled"])]),t("div",J,[K,Q,e.prenotazione.societa_sportiva?(l(),u("div",G,[t("div",W,[X,t("span",Z,f(e.prenotazione.societa_sportiva.ragione_sociale),1)])])):(l(),u("div",R," Nessuna societ\xE0 selezionata "))])]),ee,t("div",ie,[n(o(N),{value:e.prenotazione.note,"onUpdate:value":a[9]||(a[9]=s=>e.prenotazione.note=s),placeholder:"Note prenotazione",spellcheck:!1},null,8,["value"])])]),t("div",te,[n(o(c),{width:"100%",text:"Chiudi",type:"danger",icon:"close","styling-mode":"contained",disabled:e.saving,onClick:a[10]||(a[10]=s=>e.$emit("close"))},null,8,["disabled"]),n(o(c),{id:"saveButton",width:"100%",text:e.saving?"Salvataggio...":e.disabledElement?"Prenotazione gi\xE0 accettata":"Salva prenotazione",icon:"save",type:"success","styling-mode":"contained",disabled:e.disabledElement||e.saving,onClick:a[11]||(a[11]=s=>e.salvaPrenotazione())},null,8,["text","disabled"])])]))]),_:1})]),_:1})])]),ae,e.errors?(l(),m(_,{key:0,errors:e.errors},null,8,["errors"])):v("",!0),e.modal_societa_id?(l(),m(D,{key:1,"societa-id":e.modal_societa_id,onClose:a[12]||(a[12]=s=>e.modal_societa_id=null),onStore:e.societaSalvata,onUpdate:e.societaModificata},null,8,["societa-id","onStore","onUpdate"])):v("",!0)]),_:1})]),_:1},8,["show"])}}});export{_e as default};
