import{d as t,o as r,c,u as o,H as h,w as l,f as s,I as f,J as d,_ as v,e as p,U as g,a as z,B as y}from"./app.ff11f486.js";import{b5 as m}from"./check_box.a3b61762.js";import{_ as b}from"./date-box.e1bfc4ae.js";import{_ as w}from"./number-box.598f1659.js";import{D as _}from"./text-area.170595cb.js";import{D as x}from"./select-box.667df2dc.js";import{a as u}from"./response.70bff4ea.js";import"./date_box.9adfc2d5.js";import"./select_box.d813d406.js";import"./number_box.ef233ea9.js";const D=t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),$={class:"fixed inset-0 z-50 overflow-y-auto"},k={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},C={key:0,class:"flex justify-center items-center"},j=t("svg",{class:"animate-spin h-5 w-5 text-gray-900",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),B=[j],E={key:1},S={class:"mt-2"},U={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},H={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},M={class:"mt-5 sm:mt-6 flex flex-col sm:flex-row sm:justify-around gap-4"},A=t("button",{class:"opacity-0 absolute bottom-0"},null,-1),N={props:["appointmentData"],emits:["update","store","close"],data(){return{fetching:!1,saving:!1,errors:null,now:dayjs().format("YYYY-MM-DD HH:mm"),prenotazione:null,colori:[]}},computed:{disabledElement(){return this.saving},open(){return this.appointmentData!==null}},async created(){this.appointmentData.id?(this.fetching=!0,await axios.get(`api/sphere/prenotazione/${this.appointmentData.id}/edit`).then(e=>{this.prenotazione=e.data.prenotazione,this.prenotazione.durata=dayjs(e.data.prenotazione.data_fine).diff(e.data.prenotazione.data_inizio,"minute"),this.colori=e.data.colori}).catch(e=>{this.$emit("close")}),this.fetching=!1):(this.fetching=!0,await axios.post("api/sphere/prenotazione/create",this.appointmentData).then(e=>{this.prenotazione=e.data.prenotazione,this.prenotazione.durata=dayjs(e.data.prenotazione.data_fine).diff(e.data.prenotazione.data_inizio,"minute"),this.colori=e.data.colori}).catch(e=>{this.$emit("close")}),this.fetching=!1)},methods:{errorFor(e){return!!(this.errors!==null&&this.errors[e])},coloriTemplate(e){return'<div class="flex capitalize font-bold text-['+e.codice+']">'+e.nome+"</div>"},salvaPrenotazione(){this.prenotazione.id?this.update():this.store()},async update(){this.saving=!0,this.errors=null,await axios.put(`api/sphere/prenotazione/${this.prenotazione.id}`,this.prenotazione).then(e=>{this.$emit("update",e.data)}).catch(e=>{u(e)&&(this.errors=e.response.data.errors),this.saving=!1}),this.saving=!1},async store(){this.errors=null,this.saving=!0,await axios.post("api/sphere/prenotazione",this.prenotazione).then(e=>{this.$emit("store",e.data),this.$emit("close")}).catch(e=>{u(e)&&(this.errors=e.response.data.errors),this.saving=!1}),this.saving=!1}}},K=Object.assign(N,{__name:"ModalAssenzaCalendario",setup(e){return(a,i)=>(r(),c(o(h),{as:"template",show:a.open},{default:l(()=>[s(o(f),{as:"div",class:"relative z-50"},{default:l(()=>[s(o(d),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:l(()=>[D]),_:1}),t("div",$,[t("div",k,[s(o(d),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:l(()=>[s(o(v),{class:"relative transform rounded-lg bg-white px-4 pt-5 pb-4 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl sm:p-6"},{default:l(()=>[a.fetching?(r(),p("div",C,B)):(r(),p("div",E,[t("div",null,[s(o(g),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900 text-center capitalize"},{default:l(()=>[z(y(a.prenotazione.id?"Modifica":"Creazione")+" Assenza ",1)]),_:1}),t("div",S,[t("div",U,[t("div",null,[s(o(b),{value:a.prenotazione.data_inizio,"onUpdate:value":i[0]||(i[0]=n=>a.prenotazione.data_inizio=n),min:a.now,type:"datetime","is-valid":!a.errorFor("data_inizio"),label:"Data e ora della visita",disabled:a.disabledElement},null,8,["value","min","is-valid","disabled"])]),t("div",null,[s(o(w),{value:a.prenotazione.durata,"onUpdate:value":i[1]||(i[1]=n=>a.prenotazione.durata=n),placeholder:"Durata visita in minuti","is-valid":!a.errorFor("durata"),label:"Durata della visita",disabled:a.disabledElement},null,8,["value","is-valid","disabled"])])]),t("div",H,[s(o(_),{value:a.prenotazione.note,"onUpdate:value":i[2]||(i[2]=n=>a.prenotazione.note=n),label:"Note","label-mode":"floating",placeholder:"Scrivi qualcosa...",spellcheck:!1},null,8,["value"]),t("div",null,[s(o(x),{value:a.prenotazione.colore,"onUpdate:value":i[3]||(i[3]=n=>a.prenotazione.colore=n),"data-source":a.colori,"value-expr":"codice","display-expr":"nome","search-enabled":!1,label:"Colore","label-mode":"floating","item-template":a.coloriTemplate,disabled:a.disabledElement,"drop-down-options":{maxHeight:"200px"}},null,8,["value","data-source","item-template","disabled"])])])])]),t("div",M,[s(o(m),{width:"100%",text:"Chiudi",type:"danger",icon:"close","styling-mode":"contained",disabled:a.saving,onClick:i[4]||(i[4]=n=>a.$emit("close"))},null,8,["disabled"]),s(o(m),{id:"saveButton",width:"100%",text:a.saving?"Salvataggio...":a.disabledElement?"Prenotazione gi\xE0 accettata":"Salva",icon:"save",type:"success","styling-mode":"contained",disabled:a.disabledElement||a.saving,onClick:i[5]||(i[5]=n=>a.salvaPrenotazione())},null,8,["text","disabled"])])]))]),_:1})]),_:1})])]),A]),_:1})]),_:1},8,["show"]))}});export{K as default};
