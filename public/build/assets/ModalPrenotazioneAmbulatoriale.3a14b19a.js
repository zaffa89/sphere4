import{d as t,ar as $,o as c,c as f,u as s,H as C,w as p,f as n,I as M,J as P,_ as N,e as m,U as T,a as Y,B as l,C as z,al as A}from"./app.e0b64a2d.js";import U from"./ModalPaziente.61edf2ea.js";import{g as k,b4 as I,b5 as u}from"./check_box.9d1619d3.js";import{D as h}from"./select-box.44b95513.js";import{_ as B}from"./date-box.58c5ef6e.js";import{_ as F}from"./number-box.60e27d35.js";import"./check-box.76fadd22.js";import"./radio-group.dae3669f.js";import{D as H}from"./text-area.2fa8fbc0.js";import"./data_source.7e477e74.js";import{a as E,i as V}from"./response.70bff4ea.js";import"./select_box.f7ade88d.js";import"./date_box.af268e83.js";import"./number_box.9ca8c8f2.js";const L=t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),q={class:"fixed inset-0 z-50 overflow-y-auto"},K={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},J={key:0,class:"flex justify-center items-center"},O=t("svg",{class:"animate-spin h-5 w-5 text-gray-900",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),R=[O],G={key:1},Q={class:"flex flex-col gap-3"},W={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},X={class:"flex flex-col gap-1"},Z=t("div",{class:"relative"},[t("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[t("div",{class:"w-full border-t border-gray-300"})]),t("div",{class:"relative flex justify-center"},[t("span",{class:"bg-white px-2 text-sm text-gray-500"},"Data e ora prenotazione")])],-1),ee={key:0,class:"text-red-500 text-sm"},te=t("div",{class:"relative"},[t("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[t("div",{class:"w-full border-t border-gray-300"})]),t("div",{class:"relative flex justify-center"},[t("span",{class:"bg-white px-2 text-sm text-gray-500"},"Paziente / Atleta")])],-1),ae={class:"flex items-center gap-3"},ie={class:"flex flex-col gap-1"},se=t("div",{class:"relative"},[t("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[t("div",{class:"w-full border-t border-gray-300"})]),t("div",{class:"relative flex justify-center"},[t("span",{class:"bg-white px-2 text-sm text-gray-500"},"Listino")])],-1),oe={class:"flex flex-col gap-1"},ne=t("div",{class:"relative"},[t("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[t("div",{class:"w-full border-t border-gray-300"})]),t("div",{class:"relative flex justify-center"},[t("span",{class:"bg-white px-2 text-sm text-gray-500"},"Dettagli paziente")])],-1),le={key:0,class:"flex justify-center items-center h-full"},re={key:1},de={class:"flex justify-between pt-1"},ce=t("span",{class:"text-sm text-gray-500"},"Nome: ",-1),pe={class:"text-sm font-medium text-gray-900 capitalize"},me={class:"flex justify-between pt-1"},ue=t("span",{class:"text-sm text-gray-500"},"Cognome: ",-1),he={class:"text-sm font-medium text-gray-900 capitalize"},ve={class:"flex justify-between pt-1"},fe=t("span",{class:"text-sm text-gray-500"},"ragsoc: ",-1),ze={class:"text-sm font-medium text-gray-900 capitalize"},ge={class:"flex justify-between pt-1"},be=t("span",{class:"text-sm text-gray-500"},"Sesso: ",-1),ye={class:"text-sm font-medium text-gray-900 capitalize"},_e={class:"flex justify-between pt-1"},xe=t("span",{class:"text-sm text-gray-500"},"Data di nascita: ",-1),we={class:"text-sm font-medium text-gray-900 capitalize"},je={class:"flex justify-between pt-1"},De=t("span",{class:"text-sm text-gray-500"},"Nato a: ",-1),Pe={class:"text-sm font-medium text-gray-900 uppercase"},ke={class:"flex justify-between pt-1"},Ie=t("span",{class:"text-sm text-gray-500"},"Codice fiscale: ",-1),Ee={class:"text-sm font-medium text-gray-900 uppercase"},Se={class:"flex justify-between pt-1"},$e=t("span",{class:"text-sm text-gray-500"},"Residenza: ",-1),Ce={class:"text-sm font-medium text-gray-900 uppercase"},Me={class:"flex justify-between pt-1"},Ne=t("span",{class:"text-sm text-gray-500"},"Indirizzo: ",-1),Te={class:"text-sm text-gray-900 uppercase text-right"},Ye={class:"flex justify-between pt-1"},Ae=t("span",{class:"text-sm text-gray-500"},"Cellulare: ",-1),Ue={class:"text-sm font-medium text-gray-900 capitalize"},Be={class:"flex justify-between pt-1"},Fe=t("span",{class:"text-sm text-gray-500"},"Fisso: ",-1),He={class:"text-sm font-medium text-gray-900 capitalize"},Ve={class:"flex justify-between pt-1"},Le=t("span",{class:"text-sm text-gray-500"},"Indirizzo Email: ",-1),qe={class:"text-sm font-medium text-gray-900 capitalize"},Ke=t("div",{class:"relative"},[t("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[t("div",{class:"w-full border-t border-gray-300"})]),t("div",{class:"relative flex justify-center"},[t("span",{class:"bg-white px-2 text-sm text-gray-500"},"Dettagli ambulatoriale")])],-1),Je=t("div",{class:"relative"},[t("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[t("div",{class:"w-full border-t border-gray-300"})]),t("div",{class:"relative flex justify-center"},[t("span",{class:"bg-white px-2 text-sm text-gray-500"},"Altro")])],-1),Oe={class:"grid grid-cols-1 pt-4"},Re={class:"mt-5 sm:mt-6 flex flex-col sm:flex-row sm:justify-around gap-4"},Ge=t("button",{class:"opacity-0 absolute bottom-0"},null,-1),Qe={props:["appointmentData"],emits:["update","store","close"],data(){return{fetching:!1,saving:!1,errors:null,now:dayjs().format("YYYY-MM-DD HH:mm"),struttura:[],prenotazione:[],societa:null,listini:[],colori:[],modalPazienteId:null,datiTesseraSanitaria:null}},computed:{disabledElement(){return this.prenotazione.accettata||this.saving},open(){return this.appointmentData!==null},sezioneVisita(){return this.prenotazione.sezione_visita},ambulatoriPrenotabili(){return this.struttura.ambulatori},mediciPrenotabili(){let a=[];return this.$page.props.settings.limita_medici_con_orario_medico.value?this.struttura.orari_medici.forEach(d=>{dayjs(this.prenotazione.data_inizio,"YYYY-MM-DD").isSame(d.data_inizio,"day")&&d.ambulatorio_id==this.prenotazione.ambulatorio_id&&a.push(this.medici.find(e=>e.id==d.medico_id))}):a=this.medici,[...new Set(a.map(d=>d))]},orarioInOrarioMedico(){return this.struttura.orari_medici.find(a=>dayjs(this.prenotazione.data_inizio).isBetween(a.data_inizio,a.data_fine,null,"[]")&&a.ambulatorio_id==this.prenotazione.ambulatorio_id&&a.medico_id==this.prenotazione.medico_id)}},watch:{"prenotazione.ambulatorio_id":{handler(a,r){r&&r!==a&&(this.prenotazione.medico_id=null)}}},async created(){this.appointmentData.id?(this.fetching=!0,await axios.get(`api/sphere/ambulatoriale/prenotazione/edit/${this.appointmentData.id}`).then(a=>{this.prenotazione=a.data.prenotazione,this.prenotazione.durata=dayjs(a.data.prenotazione.data_fine).diff(a.data.prenotazione.data_inizio,"minute"),this.struttura=a.data.struttura,this.listini=a.data.listini,this.medici=a.data.medici}).catch(a=>{this.fetching=!1,this.$emit("close")}),this.fetching=!1):(this.fetching=!0,await axios.post("api/sphere/ambulatoriale/prenotazione/create",this.appointmentData).then(a=>{this.prenotazione=a.data.prenotazione,this.prenotazione.durata=dayjs(a.data.prenotazione.data_fine).diff(a.data.prenotazione.data_inizio,"minute"),this.struttura=a.data.struttura,this.listini=a.data.listini,this.medici=a.data.medici}).catch(a=>{this.fetching=!1,this.$emit("close")}),this.fetching=!1)},methods:{apriModalNuovoPaziente(a=null){this.modalPazienteId="new",this.datiTesseraSanitaria=a},apriModalModificaPaziente(){this.modalPazienteId=this.prenotazione.visita.paziente_id},cambiaPaziente(a){this.prenotazione.visita.paziente_id=a.id,this.prenotazione.visita.paziente=a,this.modalPazienteId=null,this.$refs.selectboxPaziente.instance.repaint()},formatDataNascita(a){return dayjs(a).format("DD/MM/YYYY")},errorFor(a){return!!(this.errors!==null&&this.errors[a])},pazienteItemTemplate(a){let r=a.data_nascita?dayjs(a.data_nascita).format("DD/MM/YYYY"):"N/A";return'<div class="flex justify-between"><span class="truncate capitalize">'+a.ragione_sociale+"</span><span>"+r+"</span></div>"},societaItemTemplate(a){return'<div class="flex justify-between"><span class="truncate">'+a.ragione_sociale+"</span></div>"},ambulatorioItemTemplate(a){return'<div class="flex justify-between"><span class="truncate">'+a.nome+"</span></div>"},medicoItemTemplate(a){return'<div class="flex justify-between"><span class="truncate">'+a.ragione_sociale+"</span></div>"},sportItemTemplate(a){return'<div class="flex justify-between"><span class="uppercase truncate">'+a.nome+"</span><span>"+a.tipo_visita+"</span></div>"},listinoItemTemplate(a){return'<div class="flex justify-between"><span class="truncate">'+a.nome+"</span><span>"+a.codice+"</span></div>"},coloriTemplate(a){return'<div class="flex capitalize font-bold text-['+a.codice+']">'+a.nome+"</div>"},selezionaPaziente(a){this.prenotazione.visita.paziente=a.selectedItem},selezionaSocieta(a){this.societa=a.selectedItem},salvaPrenotazione(){this.prenotazione.id?this.update():this.store()},async update(){this.saving=!0,this.errors=null,await axios.put(`api/sphere/prenotazione/${this.prenotazione.id}`,this.prenotazione).then(a=>{this.$emit("update",a.data)}).catch(a=>{E(a)&&(this.errors=a.response.data.errors),this.saving=!1}),this.saving=!1},async store(){this.errors=null,this.saving=!0,await axios.post("api/sphere/ambulatoriale/prenotazione/store",this.prenotazione).then(a=>{this.$emit("store",a.data)}).catch(a=>{E(a)&&(this.errors=a.response.data.errors),this.saving=!1}),this.saving=!1},calcolaAnni(a){const r=dayjs(a);return dayjs().diff(r,"year")},letturaTessera(){var a;(a=window.electron)!=null||window.electron.leggiTessera().then(r=>{r=="no tessera"?console.log("nessuna tessera inserita"):axios.get(`api/sphere/cerca-tramite-codice-fiscale/${r.codice_fiscale}`).then(d=>{this.cambiaPaziente(d.data)}).catch(d=>{V(d)?(console.log("nessun paziente trovato con codice fiscale "+r.codice_fiscale),this.apriModalNuovoPaziente(r)):console.log("errore controllo codice fiscale")})})}}},pt=Object.assign(Qe,{__name:"ModalPrenotazioneAmbulatoriale",setup(a){const r=new k({store:new I({key:"id",useDefaultSearch:!1,load(e){if(e.searchValue)return axios.get(`api/sphere/ricerca-paziente/${e.searchValue}`).then(i=>i.data).catch(i=>{throw new Error("Errore caricamento")})},byKey:e=>axios.get(`api/sphere/paziente/${e}`).then(i=>i.data).catch(i=>{throw new Error("Errore caricamento localit\xE0")}),errorHandler:e=>{console.log(e.message)}})}),d=new k({store:new I({key:"id",useDefaultSearch:!1,load(e){if(e.searchValue)return axios.get(`api/sphere/ricerca-societa/${e.searchValue}`).then(i=>i.data).catch(i=>{throw new Error("Errore caricamento")})},byKey:e=>axios.get(`api/sphere/societa-sportiva/${e}`).then(i=>i.data).catch(i=>{throw new Error("Errore caricamento localit\xE0")}),errorHandler:e=>{console.log(e.message)}})});return(e,i)=>{const S=$("AlertErrors");return c(),f(s(C),{as:"template",show:e.open},{default:p(()=>[n(s(M),{as:"div",class:"relative z-50"},{default:p(()=>[n(s(P),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[L]),_:1}),t("div",q,[t("div",K,[n(s(P),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:p(()=>[n(s(N),{class:"relative transform rounded-lg bg-white px-4 pt-5 pb-4 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl sm:p-6"},{default:p(()=>{var v,g,b,y,_,x,w,j,D;return[e.fetching?(c(),m("div",J,R)):(c(),m("div",G,[n(s(T),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900 text-center"},{default:p(()=>[Y(l(e.prenotazione.id?"Modifica prenotazione ambulatoriale":"Nuova prenotazione ambulatoriale"),1)]),_:1}),t("div",Q,[t("div",W,[t("div",X,[Z,n(s(B),{value:e.prenotazione.data_inizio,"onUpdate:value":i[0]||(i[0]=o=>e.prenotazione.data_inizio=o),min:e.now,type:"datetime","is-valid":!e.errorFor("data_inizio"),label:"Data e ora della visita",disabled:e.disabledElement},null,8,["value","min","is-valid","disabled"]),n(s(F),{value:e.prenotazione.durata,"onUpdate:value":i[1]||(i[1]=o=>e.prenotazione.durata=o),placeholder:"Durata visita in minuti","show-spin-buttons":!0,"is-valid":!e.errorFor("durata"),label:"Durata della visita",disabled:e.disabledElement},null,8,["value","is-valid","disabled"]),n(s(h),{value:e.prenotazione.ambulatorio_id,"onUpdate:value":i[2]||(i[2]=o=>e.prenotazione.ambulatorio_id=o),"data-source":e.ambulatoriPrenotabili,"value-expr":"id","display-expr":"nome",label:"Ambulatorio","label-mode":"static",placeholder:"---","no-data-text":"Nessun ambulatorio selezionabile",disabled:e.ambulatoriPrenotabili.length===0||e.disabledElement,"drop-down-options":{maxHeight:"200px"},"item-template":e.ambulatorioItemTemplate,"is-valid":!e.errorFor("ambulatorio_id")},null,8,["value","data-source","disabled","item-template","is-valid"]),n(s(h),{value:e.prenotazione.medico_id,"onUpdate:value":i[3]||(i[3]=o=>e.prenotazione.medico_id=o),"data-source":e.mediciPrenotabili,"value-expr":"id","display-expr":"ragione_sociale",label:"Medico","label-mode":"static",placeholder:"---","no-data-text":"Nessun medico selezionabile",disabled:e.mediciPrenotabili.length===0||e.disabledElement,"drop-down-options":{maxHeight:"200px"},"item-template":e.medicoItemTemplate,"is-valid":!e.errorFor("medico_id")},null,8,["value","data-source","disabled","item-template","is-valid"]),!e.orarioInOrarioMedico&&e.$page.props.settings.avviso_presenza_orario_medico.value?(c(),m("p",ee," Data e ora scelti non sono all'interno di un orario medico ")):z("",!0),te,t("div",ae,[t("div",ie,[n(s(u),{width:"100%",text:"Leggi Tessera Sanitaria",type:"normal",icon:"find","styling-mode":"contained",disabled:!1,onClick:e.letturaTessera},null,8,["onClick"]),n(s(u),{id:"saveButton",width:"100%",text:"Nuovo paziente",icon:"plus",type:"normal","styling-mode":"contained",disabled:!1,onClick:i[4]||(i[4]=o=>e.apriModalNuovoPaziente())})]),n(s(u),{id:"saveButton",width:"100%",height:"100%",text:"Apri paziente",icon:"activefolder",type:"normal","styling-mode":"contained",disabled:!e.prenotazione.visita.paziente_id,onClick:e.apriModalModificaPaziente},null,8,["disabled","onClick"])]),n(s(h),{ref:"selectboxPaziente",value:e.prenotazione.visita.paziente_id,"onUpdate:value":i[5]||(i[5]=o=>e.prenotazione.visita.paziente_id=o),"data-source":s(r),"value-expr":"id","display-expr":"ragione_sociale","search-enabled":!0,"search-timeout":500,label:"Paziente","label-mode":"static",placeholder:"Cognome e Nome","no-data-text":"Nessuna anagrafica trovata",disabled:e.disabledElement,"drop-down-options":{maxHeight:"200px"},"item-template":e.pazienteItemTemplate,"on-selection-changed":e.selezionaPaziente,"is-valid":!e.errorFor("paziente_id"),"open-on-field-click":!1,"min-search-length":2},null,8,["value","data-source","disabled","item-template","on-selection-changed","is-valid"]),se,n(s(h),{value:e.prenotazione.visita.listino_id,"onUpdate:value":i[6]||(i[6]=o=>e.prenotazione.visita.listino_id=o),"search-enabled":!0,label:"Listino","data-source":e.listini,"value-expr":"id","display-expr":"nome","item-template":e.listinoItemTemplate,"is-valid":!e.errorFor("visita.listino_id"),disabled:e.disabledElement,"no-data-text":"Nessun listino trovato"},null,8,["value","data-source","item-template","is-valid","disabled"]),n(s(h),{value:e.prenotazione.societa_id,"onUpdate:value":i[7]||(i[7]=o=>e.prenotazione.societa_id=o),"data-source":s(d),"value-expr":"id","display-expr":"ragione_sociale","search-enabled":!0,"search-timeout":500,label:"Societ\xE0 sportiva","label-mode":"static","no-data-text":"Nessuna societ\xE0 trovata",disabled:e.disabledElement,"drop-down-options":{maxHeight:"200px"},"on-selection-changed":e.selezionaSocieta,"is-valid":!e.errorFor("societa_id"),"open-on-field-click":!1,"min-search-length":2},null,8,["value","data-source","disabled","on-selection-changed","is-valid"])]),t("div",oe,[ne,e.prenotazione.visita.paziente?(c(),m("div",re,[t("div",de,[ce,t("span",pe,l(e.prenotazione.visita.paziente.nome),1)]),t("div",me,[ue,t("span",he,l(e.prenotazione.visita.paziente.cognome),1)]),t("div",ve,[fe,t("span",ze,l(e.prenotazione.visita.paziente.ragione_sociale),1)]),t("div",ge,[be,t("span",ye,l(e.prenotazione.visita.paziente.sesso),1)]),t("div",_e,[xe,t("span",we,l(s(A)(e.prenotazione.visita.paziente.data_nascita))+" ( "+l(e.calcolaAnni(e.prenotazione.visita.paziente.data_nascita))+" anni ) ",1)]),t("div",je,[De,t("span",Pe,l((v=e.prenotazione.visita.paziente.localita_nascita)==null?void 0:v.nome)+" ( "+l((g=e.prenotazione.visita.paziente.localita_nascita)==null?void 0:g.sigla_provincia)+" )",1)]),t("div",ke,[Ie,t("span",Ee,l((b=e.prenotazione.visita.paziente)==null?void 0:b.codice_fiscale),1)]),t("div",Se,[$e,t("span",Ce,l((y=e.prenotazione.visita.paziente.localita_residenza)==null?void 0:y.nome)+" ( "+l((_=e.prenotazione.visita.paziente.localita_residenza)==null?void 0:_.sigla_provincia)+" )",1)]),t("div",Me,[Ne,t("span",Te,l((x=e.prenotazione.visita.paziente)==null?void 0:x.indirizzo),1)]),t("div",Ye,[Ae,t("span",Ue,l((w=e.prenotazione.visita.paziente)==null?void 0:w.telefono),1)]),t("div",Be,[Fe,t("span",He,l((j=e.prenotazione.visita.paziente)==null?void 0:j.telefono_fisso),1)]),t("div",Ve,[Le,t("span",qe,l((D=e.prenotazione.visita.paziente)==null?void 0:D.email),1)])])):(c(),m("div",le," Nessun paziente selezionato ")),Ke])]),Je,t("div",Oe,[n(s(H),{value:e.prenotazione.note,"onUpdate:value":i[8]||(i[8]=o=>e.prenotazione.note=o),placeholder:"Note prenotazione",spellcheck:!1},null,8,["value"])])]),t("div",Re,[n(s(u),{width:"100%",text:"Chiudi",type:"danger",icon:"close","styling-mode":"contained",disabled:e.saving,onClick:i[9]||(i[9]=o=>e.$emit("close"))},null,8,["disabled"]),n(s(u),{id:"saveButton",width:"100%",text:e.saving?"Salvataggio...":e.disabledElement?"Prenotazione gi\xE0 accettata":"Salva prenotazione",icon:"save",type:"success","styling-mode":"contained",disabled:e.disabledElement||e.saving,onClick:i[10]||(i[10]=o=>e.salvaPrenotazione())},null,8,["text","disabled"])])]))]}),_:1})]),_:1})])]),Ge,e.errors?(c(),f(S,{key:0,errors:e.errors},null,8,["errors"])):z("",!0),e.modalPazienteId?(c(),f(U,{key:1,"paziente-id":e.modalPazienteId,"dati-tessera":e.datiTesseraSanitaria,onClose:i[11]||(i[11]=v=>e.modalPazienteId=null),onStore:e.cambiaPaziente,onUpdate:e.cambiaPaziente},null,8,["paziente-id","dati-tessera","onStore","onUpdate"])):z("",!0)]),_:1})]),_:1},8,["show"])}}});export{pt as default};
