import{b as i,az as h,o as p,c as m,u as s,S as C,w as r,l as o,q as E,m as f,U as F,k as g,Z as U,a as D,v as T,y as b}from"./app.91faff10.js";import{i as k,a as v}from"./response.70bff4ea.js";import{l as N,D as d,a as j,b as c}from"./check-box.3b03f7e3.js";import{g as I,b4 as $,b5 as z}from"./check_box.bd4929f9.js";import{D as u}from"./select-box.9cc7c130.js";import{_ as y}from"./date-box.cf07a735.js";import{_ as x}from"./radio-group.6a7b6bf0.js";import{D as M}from"./text-area.ef96479a.js";import"./data_source.6be12e61.js";import"./select_box.e8817efd.js";import"./date_box.745fde92.js";import"./number_box.976ffa07.js";const S=i("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),L={class:"fixed inset-0 z-50 overflow-y-auto"},A={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},B={key:0,class:"flex justify-center items-center"},V=i("svg",{class:"animate-spin h-5 w-5 text-gray-900",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[i("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),i("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),P=[V],H={key:1},R={class:"flex flex-col gap-1"},Y={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},q={class:"flex flex-col gap-1"},G=i("div",{class:"relative"},[i("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[i("div",{class:"w-full border-t border-gray-300"})]),i("div",{class:"relative flex justify-center"},[i("span",{class:"bg-white px-2 text-sm text-gray-500"},"Dati anagrafici")])],-1),K={class:"flex justify-between border border-gray-300 rounded px-[9px] py-1 mt-1 items-center"},Z=i("span",{class:"text-gray-400 font-light"},"Sesso",-1),J={class:"flex flex-col gap-1"},O=i("div",{class:"relative"},[i("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[i("div",{class:"w-full border-t border-gray-300"})]),i("div",{class:"relative flex justify-center"},[i("span",{class:"bg-white px-2 text-sm text-gray-500"},"Residenza e contatti")])],-1),Q={class:"flex gap-3"},W={class:"flex-grow"},X={class:"flex-shrink"},ee={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},ae={class:"flex flex-col gap-1"},ie=i("div",{class:"relative"},[i("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[i("div",{class:"w-full border-t border-gray-300"})]),i("div",{class:"relative flex justify-center"},[i("span",{class:"bg-white px-2 text-sm text-gray-500"},"Documenti e altre informazioni")])],-1),te={class:"flex flex-col gap-1"},se=i("div",{class:"relative"},[i("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[i("div",{class:"w-full border-t border-gray-300"})]),i("div",{class:"relative flex justify-center"},[i("span",{class:"bg-white px-2 text-sm text-gray-500"},"Note e Consensi")])],-1),le={class:"flex justify-between"},oe=i("p",{class:"text-gray-700"},"Atleta con disabilit\xE0",-1),ne={class:"flex justify-between"},de=i("p",{class:"text-gray-700"},"Consenso privacy",-1),re={class:"flex justify-between"},pe=i("p",{class:"text-gray-700"},"Consenso invio 730",-1),ce={class:"flex justify-between"},ue=i("p",{class:"text-gray-700"},"Consenso invio SMS",-1),me={class:"flex justify-between"},ve=i("p",{class:"text-gray-700"},"Consenso invio Email",-1),he={class:"mt-5 sm:mt-6 flex flex-col sm:flex-row sm:justify-around gap-4"},fe=i("button",{class:"opacity-0 absolute bottom-0"},null,-1),ge={props:["pazienteId","datiTessera"],emits:["update","store","close"],data(){return{fetching:!1,saving:!1,calcolo_cf:!1,errors:null,paziente_doppio_trovato:null,paziente:{},documenti:[{id:1,text:"Patente"},{id:2,text:"Passaporto"},{id:3,text:"Carta d'identit\xE0"},{id:4,text:"Permesso di soggiorno"}]}},computed:{disabledElement(){return this.fetching||this.saving||this.calcolo_cf},open(){return this.pazienteId!==null}},async created(){N("it-IT"),this.pazienteId==="new"?(console.log(this.datiTessera),this.fetching=!0,await axios.get("api/sphere/paziente/create").then(async l=>{this.paziente=l.data,this.datiTessera&&(console.log(this.datiTessera),this.paziente.nome=this.datiTessera.nome,this.paziente.cognome=this.datiTessera.cognome,this.paziente.data_nascita=this.datiTessera.data_nascita.substring(4,8)+"-"+this.datiTessera.data_nascita.substring(2,4)+"-"+this.datiTessera.data_nascita.substring(0,2),this.paziente.sesso=this.datiTessera.sesso,this.paziente.localita_nascita_id=await axios.get(`api/sphere/ricerca-localita/codice-catastale/${this.datiTessera.comune_nascita}`).then(n=>n.data.id),this.paziente.codice_fiscale=this.datiTessera.codice_fiscale)}).catch(l=>{this.fetching=!1,console.log(l),this.$emit("close")}),this.fetching=!1):(this.fetching=!0,await axios.get(`api/sphere/paziente/${this.pazienteId}/edit`).then(l=>{this.paziente=l.data}).catch(l=>{this.fetching=!1,this.$emit("close")}),this.fetching=!1)},methods:{errorFor(l){return!!(this.errors!==null&&this.errors[l])},localitaItemTemplate(l){return l?'<div class="flex gap-2"><span class="truncate capitalize">'+l.nome+'</span> <span class="uppercase">('+l.sigla_provincia+")</span></div>":"<div />"},selezionaLocalitaNascita(l){this.paziente.localita_nascita=l.selectedItem},selezionaLocalitaResidenza(l){this.paziente.localita_residenza=l.selectedItem},selezionaLocalitaRilascioDocumento(l){this.paziente.localita_rilascio_documento=l.selectedItem},async cercaTramiteCodiceFiscale(l){await axios.get(`api/sphere/cerca-tramite-codice-fiscale/${l}`).then(n=>{var e;n.data.id!==((e=this.paziente)==null?void 0:e.id)&&(this.paziente_doppio_trovato=n.data)}).catch(n=>{k(n)&&(this.paziente_doppio_trovato=null)})},async calcolaCodiceFiscale(){var l,n;this.errors=null,this.paziente_doppio_trovato=null,this.calcolo_cf=!0,await axios.post("api/sphere/calcola-codice-fiscale",{nome:this.paziente.nome,cognome:this.paziente.cognome,sesso:this.paziente.sesso,data_nascita:dayjs(this.paziente.data_nascita).format("YYYY-MM-DD"),codice_catastale:(n=(l=this.paziente)==null?void 0:l.localita_nascita)==null?void 0:n.codice_catastale}).then(e=>{this.paziente.codice_fiscale=e.data,this.cercaTramiteCodiceFiscale(e.data)}).catch(e=>{v(e)&&(this.errors=e.response.data.errors),this.calcolo_cf=!1}),this.calcolo_cf=!1},salvaPaziente(){this.paziente.id?this.update():this.store()},async update(){this.errors=null,this.saving=!0,await axios.put(`api/sphere/paziente/${this.paziente.id}`,this.paziente).then(l=>{this.$emit("update",l.data)}).catch(l=>{v(l)&&(this.errors=l.response.data.errors),this.saving=!1}),this.saving=!1},async store(){this.errors=null,this.saving=!0,await axios.post("api/sphere/paziente",this.paziente).then(l=>{this.$emit("store",l.data)}).catch(l=>{v(l)&&(this.errors=l.response.data.errors),this.saving=!1}),this.saving=!1}}},Ne=Object.assign(ge,{__name:"ModalPaziente",setup(l){const n=new I({store:new $({key:"id",useDefaultSearch:!1,load(e){if(e.searchValue)return axios.get(`api/sphere/ricerca-localita/nome/${e.searchValue}`).then(a=>a.data).catch(a=>{throw new Error("Errore caricamento")})},byKey:e=>axios.get(`api/sphere/localita/${e}`).then(a=>a.data).catch(a=>{throw new Error("Errore caricamento localit\xE0")}),errorHandler:e=>{console.log(e.message)}})});return(e,a)=>{const w=h("AlertErrors"),_=h("AlertDoppiaAnagrafica");return p(),m(s(C),{as:"template",show:e.open},{default:r(()=>[o(s(E),{as:"div",class:"relative z-50"},{default:r(()=>[o(s(f),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:r(()=>[S]),_:1}),i("div",L,[i("div",A,[o(s(f),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:r(()=>[o(s(F),{class:"relative transform rounded-lg bg-white px-4 pt-5 pb-4 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl sm:p-6"},{default:r(()=>[e.fetching?(p(),g("div",B,P)):(p(),g("div",H,[o(s(U),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900 text-center"},{default:r(()=>[D(T(e.paziente.id?"Anagrafica paziente: "+e.paziente.ragione_sociale:"Nuovo paziente"),1)]),_:1}),i("div",R,[i("div",Y,[i("div",q,[G,o(s(d),{value:e.paziente.cognome,"onUpdate:value":a[0]||(a[0]=t=>e.paziente.cognome=t),label:"Cognome","label-mode":"floating",placeholder:"Cognome","show-clear-button":!0,"is-valid":!e.errorFor("cognome"),disabled:e.disabledElement},null,8,["value","is-valid","disabled"]),o(s(d),{value:e.paziente.nome,"onUpdate:value":a[1]||(a[1]=t=>e.paziente.nome=t),label:"Nome","label-mode":"floating",placeholder:"Nome","show-clear-button":!0,"is-valid":!e.errorFor("nome"),disabled:e.disabledElement},null,8,["value","is-valid","disabled"]),i("div",K,[Z,o(s(x),{value:e.paziente.sesso,"onUpdate:value":a[2]||(a[2]=t=>e.paziente.sesso=t),items:["M","F"],layout:"horizontal","is-valid":!e.errorFor("sesso"),disabled:e.disabledElement},null,8,["value","is-valid","disabled"])]),o(s(y),{value:e.paziente.data_nascita,"onUpdate:value":a[3]||(a[3]=t=>e.paziente.data_nascita=t),placeholder:"gg/mm/aaaa","show-clear-button":!0,"use-mask-behavior":!0,"display-format":"dd/MM/yyyy","date-serialization-format":"yyyy-MM-dd",type:"date","is-valid":!e.errorFor("data_nascita"),label:"Data di nascita",disabled:e.disabledElement},null,8,["value","is-valid","disabled"]),o(s(u),{value:e.paziente.localita_nascita_id,"onUpdate:value":a[4]||(a[4]=t=>e.paziente.localita_nascita_id=t),"data-source":s(n),"value-expr":"id","display-expr":"nome","search-enabled":!0,"search-timeout":500,"min-search-length":2,"open-on-field-click":!1,label:"Localita di nascita","label-mode":"static",placeholder:"Localita di nascita","no-data-text":"Nessuna localit\xE0 trovata",disabled:e.disabledElement,"drop-down-options":{maxHeight:"200px"},"item-template":e.localitaItemTemplate,"on-selection-changed":e.selezionaLocalitaNascita,"is-valid":!e.errorFor("localita_nascita_id")&&!e.errorFor("codice_catastale")},null,8,["value","data-source","disabled","item-template","on-selection-changed","is-valid"]),o(s(d),{value:e.paziente.codice_fiscale,"onUpdate:value":a[5]||(a[5]=t=>e.paziente.codice_fiscale=t),label:"Codice Fiscale","label-mode":"floating",placeholder:"Codice Fiscale","show-clear-button":!0,"is-valid":!e.errorFor("codice_fiscale"),disabled:e.disabledElement},{default:r(()=>[o(s(j),{options:{icon:"check",type:"normal",onClick:()=>e.calcolaCodiceFiscale()},name:"codice_fiscale",location:"after"},null,8,["options"])]),_:1},8,["value","is-valid","disabled"])]),i("div",J,[O,i("div",Q,[i("div",W,[o(s(d),{value:e.paziente.indirizzo,"onUpdate:value":a[6]||(a[6]=t=>e.paziente.indirizzo=t),label:"Indirizzo","label-mode":"floating",placeholder:"Indirizzo","show-clear-button":!0,"is-valid":!e.errorFor("indirizzo"),disabled:e.disabledElement},null,8,["value","is-valid","disabled"])]),i("div",X,[o(s(d),{value:e.paziente.civico,"onUpdate:value":a[7]||(a[7]=t=>e.paziente.civico=t),width:"100px",label:"Civico","label-mode":"floating",placeholder:"Civico","show-clear-button":!0,"is-valid":!e.errorFor("civico"),disabled:e.disabledElement},null,8,["value","is-valid","disabled"])])]),o(s(u),{value:e.paziente.localita_residenza_id,"onUpdate:value":a[8]||(a[8]=t=>e.paziente.localita_residenza_id=t),"data-source":s(n),"value-expr":"id","display-expr":"nome","search-enabled":!0,"search-timeout":500,label:"Localita di residenza","label-mode":"static",placeholder:"Localita di residenza","no-data-text":"Nessuna localit\xE0 trovata",disabled:e.disabledElement,"drop-down-options":{maxHeight:"200px"},"open-on-field-click":!1,"min-search-length":2,"item-template":e.localitaItemTemplate,"on-selection-changed":e.selezionaLocalitaResidenza,"is-valid":!e.errorFor("localita_residenza_id")},null,8,["value","data-source","disabled","item-template","on-selection-changed","is-valid"]),o(s(d),{value:e.paziente.telefono,"onUpdate:value":a[9]||(a[9]=t=>e.paziente.telefono=t),label:"Cellulare","label-mode":"floating",placeholder:"Cellulare","show-clear-button":!0,"is-valid":!e.errorFor("telefono"),disabled:e.disabledElement},null,8,["value","is-valid","disabled"]),o(s(d),{value:e.paziente.telefono_fisso,"onUpdate:value":a[10]||(a[10]=t=>e.paziente.telefono_fisso=t),label:"Telefono fisso","label-mode":"floating",placeholder:"Telefono fisso","show-clear-button":!0,"is-valid":!e.errorFor("telefono_fisso"),disabled:e.disabledElement},null,8,["value","is-valid","disabled"]),o(s(d),{value:e.paziente.email,"onUpdate:value":a[11]||(a[11]=t=>e.paziente.email=t),label:"Indirizzo email","label-mode":"floating",placeholder:"indirizzo email","show-clear-button":!0,"is-valid":!e.errorFor("email"),disabled:e.disabledElement},null,8,["value","is-valid","disabled"])])]),i("div",ee,[i("div",ae,[ie,o(s(u),{value:e.paziente.documento,"onUpdate:value":a[12]||(a[12]=t=>e.paziente.documento=t),"data-source":e.documenti,"value-expr":"id","display-expr":"text",label:"Documento","label-mode":"floating",placeholder:"Documento",disabled:e.disabledElement,"is-valid":!e.errorFor("documento")},null,8,["value","data-source","disabled","is-valid"]),o(s(d),{value:e.paziente.documento_numero,"onUpdate:value":a[13]||(a[13]=t=>e.paziente.documento_numero=t),label:"Numero documento","label-mode":"floating",placeholder:"Numero documento","show-clear-button":!0,"is-valid":!e.errorFor("documento_numero"),disabled:e.disabledElement},null,8,["value","is-valid","disabled"]),o(s(y),{value:e.paziente.documento_data_rilascio,"onUpdate:value":a[14]||(a[14]=t=>e.paziente.documento_data_rilascio=t),placeholder:"gg/mm/aaaa","show-clear-button":!0,"use-mask-behavior":!0,"display-format":"dd/MM/yyyy","date-serialization-format":"yyyy-MM-dd",type:"date","is-valid":!e.errorFor("documento_data_rilascio"),label:"Data di rilascio",disabled:e.disabledElement},null,8,["value","is-valid","disabled"]),o(s(u),{value:e.paziente.documento_localita_rilascio_id,"onUpdate:value":a[15]||(a[15]=t=>e.paziente.documento_localita_rilascio_id=t),"data-source":s(n),"value-expr":"id","display-expr":"nome","search-enabled":!0,"search-timeout":500,"min-search-length":2,label:"Localita di rilascio","label-mode":"static",placeholder:"Localita di rilascio","no-data-text":"Nessuna localit\xE0 trovata",disabled:e.disabledElement,"drop-down-options":{maxHeight:"200px"},"open-on-field-click":!1,"item-template":e.localitaItemTemplate,"on-selection-changed":e.selezionaLocalitaRilascioDocumento,"is-valid":!e.errorFor("documento_localita_rilascio_id")},null,8,["value","data-source","disabled","item-template","on-selection-changed","is-valid"])]),i("div",te,[se,o(s(M),{value:e.paziente.note,"onUpdate:value":a[16]||(a[16]=t=>e.paziente.note=t),placeholder:"Note paziente",spellcheck:!1},null,8,["value"]),i("div",le,[oe,o(s(c),{value:e.paziente.disabile,"onUpdate:value":a[17]||(a[17]=t=>e.paziente.disabile=t)},null,8,["value"])]),o(s(d),{value:e.paziente.gruppo_sanguigno,"onUpdate:value":a[18]||(a[18]=t=>e.paziente.gruppo_sanguigno=t),label:"Gruppo sanguigno","label-mode":"floating",placeholder:"Gruppo sanguigno","show-clear-button":!0,"is-valid":!e.errorFor("gruppo_sanguigno"),disabled:e.disabledElement},null,8,["value","is-valid","disabled"]),i("div",ne,[de,o(s(c),{value:e.paziente.consenso_privacy,"onUpdate:value":a[19]||(a[19]=t=>e.paziente.consenso_privacy=t)},null,8,["value"])]),i("div",re,[pe,o(s(c),{value:e.paziente.consenso_730,"onUpdate:value":a[20]||(a[20]=t=>e.paziente.consenso_730=t)},null,8,["value"])]),i("div",ce,[ue,o(s(c),{value:e.paziente.consenso_sms,"onUpdate:value":a[21]||(a[21]=t=>e.paziente.consenso_sms=t)},null,8,["value"])]),i("div",me,[ve,o(s(c),{value:e.paziente.consenso_email,"onUpdate:value":a[22]||(a[22]=t=>e.paziente.consenso_email=t)},null,8,["value"])])])])]),i("div",he,[o(s(z),{width:"100%",text:"Chiudi",type:"danger",icon:"close","styling-mode":"contained",disabled:e.saving,onClick:a[23]||(a[23]=t=>e.$emit("close"))},null,8,["disabled"]),o(s(z),{id:"saveButton",width:"100%",text:e.saving?"Salvataggio...":"Salva modifiche",icon:"save",type:"success","styling-mode":"contained",disabled:e.disabledElement||e.saving,onClick:a[24]||(a[24]=t=>e.salvaPaziente())},null,8,["text","disabled"])])]))]),_:1})]),_:1})])]),fe,e.errors?(p(),m(w,{key:0,errors:e.errors},null,8,["errors"])):b("",!0),e.paziente_doppio_trovato?(p(),m(_,{key:1,paziente:e.paziente_doppio_trovato},null,8,["paziente"])):b("",!0)]),_:1})]),_:1},8,["show"])}}});export{Ne as default};
