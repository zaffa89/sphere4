import{ao as n,al as u,as as p,o as s,k as f,l as t,u as e,w as _,c,y as d}from"./app.91faff10.js";import v from"./ModalSchedaMedsport.c778506d.js";import h from"./ModalPrenotazioneMedsport.9926e432.js";import{D as z,a as g,b as w,c as o,d as x}from"./data-grid.93ce6c9b.js";import{l as D}from"./check-box.3b03f7e3.js";import"./index.708a0cab.js";import{_ as C}from"./plugin-vue_export-helper.21dcd24c.js";import"./response.70bff4ea.js";import"./check_box.bd4929f9.js";import"./number-box.75808b5b.js";import"./number_box.976ffa07.js";import"./select-box.9cc7c130.js";import"./select_box.e8817efd.js";import"./date-box.cf07a735.js";import"./date_box.745fde92.js";import"./text-area.ef96479a.js";import"./index.fc9ac9bc.js";import"./data_source.6be12e61.js";import"./ModalPaziente.6c0d45eb.js";import"./radio-group.6a7b6bf0.js";import"./ModalRicercaPaziente.e8a98483.js";import"./draggable.67b3fe5e.js";const M={emits:["notify"],data(){return{fetching:!1,modal_visita_id:null,modal_nuova_visita:null,ricerca:null,errors:null,visite:[],data_inizio_ricerca:n().format("YYYY-MM-DD"),data_fine_ricerca:n().format("YYYY-MM-DD")}},computed:{disabledElement(){return this.fetching}},async created(){D("it-IT"),this.caricaAccettazioni()},methods:{async caricaAccettazioni(){await axios.post("api/sphere/medsport/accettazione",{data_inizio:this.data_inizio_ricerca,data_fine:this.data_fine_ricerca}).then(i=>{this.visite=i.data})},timezoneFixer(i){return u(i.value)},dateFixer(i){return i.value?p(i.value):""},calculateAge(i){return i.paziente?n().diff(n(i.paziente.data_nascita),"year"):""},defaultSocietaText(i){var a;return(a=i.value)!=null?a:"NESSUNA"},defaultPazienteText(i){var a;return(a=i.value)!=null?a:"PAZIENTE MANCANTE"},visitaCreata(i){this.visite.push(i),this.$refs.griglia.instance.refresh(),this.$emit("notify","success","Visita creata con successo"),this.modal_visita_id=null},async visitaModificata(i){this.$emit("notify","success","Visita modificata con successo"),this.modal_visita_id=null},errorFor(i){return!!(this.errors!==null&&this.errors[i])},onRowPrepared(i){i.rowElement.className+=" hover:bg-gray-300"},openContextMenu(i){i.row&&this.$refs.griglia.instance.selectRows([i.row.key]),i.items=[{visible:i.rowIndex>-1,text:"Apri",icon:"showpanel",onItemClick:()=>{this.apriVisita(i.row.data.id)}},{visible:i.rowIndex>-1,text:"Elimina",icon:"trash",onItemClick:()=>{this.confermaEliminazioneVisita(i.rowIndex)}},{text:"Nuova accettazione",icon:"plus",onItemClick:()=>{this.nuovaVisitaSingola()}}]},aggiornaRiga(i){},onRowDblClick(i){this.apriVisita(i.data.id)},confermaEliminazioneVisita(i){this.$refs.griglia.instance.option({"editing.texts.confirmDeleteMessage":"Sei sicuro di voler eliminare questa visita?"}),this.$refs.griglia.instance.deleteRow(i)},eliminaVisita(i){i.cancel=axios.delete(`api/sphere/medsport/visita-medsport/${i.data.id}`).then(a=>(this.$emit("notify","success","Visita eliminata"),!1)).catch(a=>(this.$emit("notify","error","Errore","Eliminazione fallita"),!0))},nuovaVisitaSingola(){this.modal_nuova_visita={sezione_visita:"M",data_inizio:n().format("YYYY-MM-DD HH:mm"),data_fine:n().format("YYYY-MM-DD HH:mm"),ambulatorio_id:null,medico_id:null,struttura_id:1,nascosta:!0}},ricaricaGriglia(){this.caricaAccettazioni(),this.modal_nuova_visita={}},apriVisita(i){this.modal_visita_id=i},async ricercaPaziente(){this.fetching=!0,await axios.post("api/sphere/ricerca-paziente",{ricerca:this.ricerca}).then(i=>{this.visite=i.data}).catch(i=>{}),this.fetching=!1}}},y=Object.assign(M,{__name:"FormAccettazioneMedsport",setup(i){return(a,r)=>{var l;return s(),f("div",null,[t(e(z),{id:"griglia",ref:"griglia","data-source":a.visite,"key-expr":"id","allow-column-reordering":!0,"allow-column-resizing":!0,"column-auto-width":!0,"column-min-width":50,"column-resizing-mode":"widget","row-alternation-enabled":!0,"show-row-lines":!0,"hover-state-enabled":!0,onContextMenuPreparing:a.openContextMenu,onRowPrepared:a.onRowPrepared,onRowDblClick:a.onRowDblClick,onRowRemoving:a.eliminaVisita},{default:_(()=>[t(e(g),{mode:"single"}),t(e(w),{enabled:!0}),t(e(o),{"data-field":"prenotazione.accettata","data-type":"boolean","false-text":"NO","true-text":"SI"}),t(e(o),{"data-field":"prenotazione.data_prenotazione",caption:"Data prenotazione","customize-text":a.timezoneFixer},null,8,["customize-text"]),t(e(o),{"data-field":"prenotazione.data_inizio",caption:"Data/ora visita","customize-text":a.timezoneFixer},null,8,["customize-text"]),t(e(o),{"data-field":"societa_sportiva.ragione_sociale",caption:"Societ\xE0 sportiva","customize-text":a.defaultSocietaText},null,8,["customize-text"]),t(e(o),{"data-field":"paziente.ragione_sociale",caption:"Atleta","customize-text":a.defaultPazienteText},null,8,["customize-text"]),t(e(o),{"data-field":"paziente.data_nascita",name:"data_nascita",caption:"Data nascita","customize-text":a.dateFixer},null,8,["customize-text"]),t(e(o),{name:"eta",caption:"Et\xE0","calculate-cell-value":a.calculateAge},null,8,["calculate-cell-value"]),t(e(o),{"data-field":"listino.nome",caption:"Listino"}),t(e(o),{"data-field":"sport.nome",caption:"Sport"}),t(e(o),{caption:"Idoneo"}),t(e(o),{caption:"N\xB0 Certificato"}),t(e(o),{caption:"N\xB0 Cartella"}),t(e(o),{"data-field":"medico.ragione_sociale",caption:"Medico"}),t(e(x),{mode:"infinite"})]),_:1},8,["data-source","onContextMenuPreparing","onRowPrepared","onRowDblClick","onRowRemoving"]),a.modal_visita_id?(s(),c(v,{key:0,"visita-id":a.modal_visita_id,onClose:r[0]||(r[0]=m=>a.modal_visita_id=null),onUpdate:a.visitaModificata},null,8,["visita-id","onUpdate"])):d("",!0),((l=a.modal_nuova_visita)==null?void 0:l.sezione_visita)=="M"?(s(),c(h,{key:1,"appointment-data":a.modal_nuova_visita,onClose:r[1]||(r[1]=m=>a.modal_nuova_visita={}),onStore:a.ricaricaGriglia},null,8,["appointment-data","onStore"])):d("",!0)])}}});var Z=C(y,[["__scopeId","data-v-1b95f6bb"]]);export{Z as default};
